name: Warn on Direct Push to Main

on:
  push:
    branches:
      - main

jobs:
  warn-direct-push:
    runs-on: ubuntu-latest
    steps:
      - name: Check if direct push
        id: check
        run: |
          COMMIT_MSG="${{ github.event.head_commit.message }}"
          # Skip if this is a merge commit from a PR
          if [[ "$COMMIT_MSG" == Merge\ pull\ request* ]] || [[ "$COMMIT_MSG" == *"Merge branch"* ]]; then
            echo "is_direct_push=false" >> $GITHUB_OUTPUT
          else
            echo "is_direct_push=true" >> $GITHUB_OUTPUT
          fi

      - name: Create warning issue
        if: steps.check.outputs.is_direct_push == 'true'
        uses: actions/github-script@v7
        with:
          script: |
            const pusher = context.payload.pusher.name;
            const commitSha = context.sha.substring(0, 7);
            const commitUrl = `${context.payload.repository.html_url}/commit/${context.sha}`;
            const commitMsg = context.payload.head_commit.message.split('\n')[0];

